#!/usr/bin/env node

/**
 * Generate inline markdown data for the Tao book viewer.
 *
 * The viewer runs directly from the filesystem, where fetch()
 * cannot access sibling markdown files due to browser security policies.
 * This script bundles the raw markdown content into a lightweight JS file.
 *
 * Usage:
 *   node scripts/generate-viewer-data.mjs
 */

import { readFileSync, writeFileSync } from "node:fs";
import { fileURLToPath } from "node:url";
import { dirname, resolve } from "node:path";

const __dirname = dirname(fileURLToPath(import.meta.url));
const bookRoot = resolve(__dirname, "../docs/books/book-algorithms-of-destiny-yin-yang-compiler");

const files = [
  "index.md",
  "foreword.md",
  "afterword.md",
  "volume01-base-protocol-embeddings/index.md",
  "volume01-base-protocol-embeddings/chapter01-syntax-of-void.md",
  "volume01-base-protocol-embeddings/chapter02-vector-space-five-elements.md",
  "volume01-base-protocol-embeddings/chapter03-spacetime-crystal.md",
  "volume02-discrete-state-machine-liu-yao/index.md",
  "volume02-discrete-state-machine-liu-yao/chapter04-query-protocol.md",
  "volume02-discrete-state-machine-liu-yao/chapter05-graph-theory-model.md",
  "volume02-discrete-state-machine-liu-yao/chapter06-data-fusion.md",
  "volume03-entity-component-system-bazi/index.md",
  "volume03-entity-component-system-bazi/chapter07-initial-config.md",
  "volume03-entity-component-system-bazi/chapter08-interaction-protocol.md",
  "volume03-entity-component-system-bazi/chapter09-dynamic-evolution.md",
  "volume03-entity-component-system-bazi/chapter10-system-tuning.md",
  "volume04-biocomputing-neidan/index.md",
  "volume04-biocomputing-neidan/chapter11-thermodynamics-of-three-qi.md",
  "volume04-biocomputing-neidan/chapter12-meridian-waveguides.md",
  "volume04-biocomputing-neidan/chapter13-circular-motion-vortex.md",
  "volume04-biocomputing-neidan/chapter14-neidan-engineering.md",
  "volume05-macro-holographic-spatial/index.md",
  "volume05-macro-holographic-spatial/chapter15-holographic-principle.md",
  "volume05-macro-holographic-spatial/chapter16-spatial-geometry.md",
  "volume05-macro-holographic-spatial/chapter17-macro-simulation.md"
];

const payload = {};

for (const relativePath of files) {
  const fullPath = resolve(bookRoot, relativePath);
  payload[relativePath] = readFileSync(fullPath, "utf8");
}

const banner = `// Auto-generated by scripts/generate-viewer-data.mjs\n// Do not edit manually.\n`;
const output = `${banner}window.__TAO_MARKDOWN__ = ${JSON.stringify(payload)};\n`;

const outputPath = resolve(bookRoot, "viewer-data.js");
writeFileSync(outputPath, output, "utf8");

console.log(`Generated ${outputPath}`);

